---
lab:
    title: '探索 Azure AD 中的条件访问管理'
    module: '模块 2 第 3 课：描述 Microsoft 标识和访问管理解决方案的功能：探索 Azure AD 的访问管理功能'
---


# 实验室：探索 Azure AD 中的条件访问管理

## 实验室场景
在本实验室中，你将从管理员和用户的角度探索条件访问 MFA。  你将以管理员身份创建一个策略，该策略要求用户在访问基于云的 Microsoft Azure 管理应用程序时进行多重身份验证。  从用户的角度来看，你将看到条件访问策略的影响，包括注册 MFA 的过程。

**预计用时**：10-15 分钟

#### 任务 1：在此任务中，你将以管理员身份重置用户 Debra Berger 的密码。  此步骤需要完成，以便首次以后续任务中的用户身份登录。

1. 打开 Microsoft Edge。  在地址栏中，输入 **“portal.azure.com”**。

2. 使用管理员凭据登录。
    1. 在“登录”窗口中，输入 **“admin@WWLxZZZZZZ.onmicrosoft.com”** （其中，ZZZZZZ 是实验室托管提供商提供的唯一租户 ID），然后选择 **“下一步”**。
    1. 输入管理员密码，该密码应由实验室托管提供商提供。选择 **“登录”**。
    1. 在提示保持登录状态时，选择 **“是”**。

3. 选择 **“Azure Active Directory”**。  

4. 从左侧导航面板中，选择 **“用户”**。

5. 从用户列表中选择 **“Debra Berger”**。

6. 从页面顶部选择 **“重置密码”**。由于之前没有以 Debra Berger 的身份登录，因此你不知道他的密码，需要重置密码。

7. 当密码重置窗口打开时，请选择 **“重置密码”**。  重要说明：请记下新密码，因为你在下一个任务中需要使用该密码才能以用户身份登录。

8. 选择页面右上角的 **“X”** 关闭密码重置窗口。

9. 选择页面右上角的 **“X”** 关闭“用户”窗口。

10. 让此窗口保持打开状态。


#### 任务 2：  在此任务中，你将完成在 Azure AD 中创建条件访问策略的过程。

1. 打开标记为“Contoso - Microsoft Azure”的浏览器选项卡。   如果之前关闭了该浏览器选项卡，请打开 Microsoft Edge，在地址栏中输入“portal.azure.com”，使用管理员凭据进行登录，然后选择“Azure Active Directory”。  

2. 从左侧导航面板中，选择 **“安全性”**。

3. 从左侧导航面板中，选择 **“条件访问”**。

4. 这会显示“条件访问策略”屏幕。此处将列出所有现有的条件访问策略。选择 **“新建策略”**。

5. 在“名称”字段中，输入 **“MFA 测试策略”**。

6. 在“用户和组”下，选择 **“选择了 0 个用户和组”**。

7. 你将看到用于包含或排除用户或组的选项。  确保选择了 **“包括”** （带有下划线）。

8. 选择 **“选择用户和组”** 选项，然后选择 **“用户和组”**。  此时将打开“选择用户和组”窗口。  

9. 在搜索栏中，输入 **“Debra”**。  从搜索栏下方选择 **“Debra Berger”**，然后按页面底部的 **“选择”** 按钮。  请注意，通常的做法是将策略分配给组中的用户。  为方便完成本实验室，我们将策略分配给特定用户。 

10. 在“云应用或操作”下，选择 **“未选择云应用或操作”**。

11. 你将看到“包含或排除用户/组操作”选项。  确保已突出显示 **“云应用”** 并选中 **“包括”** （带有下划线），然后选择 **“选择应用”**。  此时将打开“选择云应用”窗口。

12. 在搜索栏中，输入 **“Azure”**。  在搜索框下方出现的搜索结果中，选择 **“Microsoft Azure 管理”**，然后按页面底部的 **“选择”** 注意警告。  

13. 在“条件”下，选择 **“选择了 0 个条件”**。  请注意可配置的各种选项。  通过该策略，可以根据来自各种条件（如风险、设备平台、位置、客户端应用或设备状态）的信号来控制用户访问。  例如，可以为策略包含一个条件，以应用于除选定或受信任位置（如总部网络）之外的任何位置。  对于此策略，不要设置任何条件。

14. 现在将设置访问控制。  在“授权”下，选择 **“选择了 0 个控件”**。

15. 此时将打开“授权”窗口。  确保选择了 **“授权访问”**，然后选择 **“需要多重身份验证”**。  在“对于多个控件”部分下，保留默认的 **“需要所有选定的控件”**。  按页面底部的 **“选择”**。

16. 在页面底部的“启用策略”下，选择 **“打开”**，然后按 **“创建”按钮**。

17. 几秒钟后，MFA 试点策略应出现在条件访问策略列表中（如果需要，请选择页面顶部的 **“刷新”**）。

18. 注销 Azure 并关闭浏览器窗口。

#### 任务 3：在此任务中，你将从用户 Debra Berger 的角度了解条件访问策略的影响。你将先登录一款未包含在条件访问策略中的应用程序。  然后，你将对一款包含在条件访问策略中的应用程序重复该过程。  回想一下，该策略要求用户在访问 Microsoft Azure 管理应用程序时进行 MFA。  要使用 MFA，用户必须先注册将用于 MFA 的身份验证方法，例如将验证码发送到移动设备或身份验证器应用程序。

1. 打开 Microsoft Edge。  在浏览器的地址栏中，输入 **“https://login.microsoftonline.com/”**

1. 以 Debra Burger 的身份登录：
    1. 在“登录”窗口中，输入 **“DebraB@WWLxZZZZZZ.onmicrosoft.com”**（其中，ZZZZZZ 是实验室托管提供商提供的唯一租户 ID），然后选择 **“下一步”**。
    1. 输入你在之前的任务中记下的密码。选择 **“登录”**。
    1. 由于你以管理员身份重置密码时提供的密码具有临时性，因此需要更新密码（这不是 MFA 的一部分）。  输入当前密码，为“新密码”和“确认密码”字段输入 **“SC900-Lab”**。
    1. 在提示保持登录状态时，选择 **“是”**

1. 你应成功登录 Microsoft 365 帐户。  此应用程序不需要进行 MFA，因为它不是策略的一部分。

1. 现在，你将尝试登录符合 MFA 条件的应用程序。  打开 Microsoft Edge，然后在地址栏中输入“https://portal.azure.com”。

1. 你将看到一个窗口，指出“需要更多信息”。  选择 **“下一步”**。  请注意，这将启动 MFA 注册过程，因为这是你第一次访问在条件访问策略中标识的云应用。  此注册过程只需执行一次。   让用户完成注册过程的替代方法是让管理员配置要使用的身份验证方法。

1. 在“保持帐户安全”窗口中，可以选择用于 MFA 的方法。  Microsoft Authenticator 便是其中一个选项。为方便进行本实验室练习，你将选择不同的方法。  选择 **“我想设置其他方法”**。  从“选择其他方法”弹出窗口中，选择 **“下拉箭头”** 并选择 **“电话”**，然后按 **“确认”**。

1. 在打开的窗口中，确保已选择了你的所在国家/地区，然后输入要使用的移动电话号码并将其选中，确保选择了 **“通过短信向我发送验证码”**，然后按 **“下一步”**。  屏幕将显示“短信已验证。你的手机已注册成功”。  选择 **“下一步”**，然后选择 **“完成”**。  这样就完成了一次性注册过程。

1. 你可能会收到一条消息，指出登录已超时。  只需输入密码 **“SC900-Lab”** 并选择 **“登录”** 即可。

1. 你将看到一个窗口，提示你输入发送到手机的验证码。  输入验证码，然后选择 **“下一步”**。  每次以 Gerhart 的身份根据 MFA 策略访问 Microsoft Azure 管理云应用程序（例如 Azure 门户）时，你都会经历这一过程。

1. 你将看到一个窗口，提示你输入发送到手机的验证码。  立即输入该验证码并按 **“验证”** 按钮。  在提示保持登录状态时，选择 **“否”**。

1. 你现在应能够访问 Azure 门户。  Azure 门户是一种 Microsoft Azure 管理应用程序，因此需要根据创建的条件访问策略进行多重身份验证。  

1. 通过选择屏幕右上角电子邮件地址旁边的用户图标并选择“注销”进行注销。然后关闭所有浏览器窗口。

#### 回顾
在本实验室中，你完成了设置条件访问策略的过程，该策略要求用户在访问 Microsoft Azure 管理云应用程序时进行 MFA。  然后，你以用户身份完成了 MFA 的注册过程，并了解了条件访问策略要求在访问 Azure 门户时使用 MFA 的影响。