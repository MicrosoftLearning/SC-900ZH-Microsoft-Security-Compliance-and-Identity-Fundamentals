---
lab:
    title: '探索 Azure Policy'
    module: '模块 4 第 5 课：描述 Microsoft 合规性解决方案的功能：描述 Azure Policy'
---


# 实验室：探索 Azure Policy

## 实验室场景
Azure Policy 可帮助实施组织标准并大规模评估合规性。Azure Policy 通过将 Azure 中资源的属性与业务规则进行比较，来评估这些资源。在本实验室中，你将首先探索 Azure 策略的登陆页面。在初步探索“Azure 策略”页面后，你将创建一个策略并了解该策略的影响。


**预计用时**： 20-25 分钟

#### 任务 1：简要探索“Azure 策略”页面。

1. 打开 Microsoft Edge。在地址栏中，输入 **“portal.microsoft.com”**。

1. 使用管理员凭据登录。
    1. 在“登录”窗口中，输入 **“admin@WWLxZZZZZZ.onmicrosoft.com”** （其中，ZZZZZZ 是实验室托管提供商提供的唯一租户 ID），然后选择 **“下一步”**。
    
    1. 输入管理员密码，该密码应由实验室托管提供商提供。选择 **“登录”**。
    1. 在提示保持登录状态时，选择 **“是”**。

1. 你现在位于 Azure 门户中。  在页面顶部 Microsoft Azure 旁边蓝色栏的搜索框中，输入“**policy**”，然后在搜索结果中选择“**Policy**”。这将打开提供仪表板视图的 Policy 主页。  在本实验室中，你看到的信息的范围适用于你正在使用的 Azure Pass。   请注意仪表板中提供的信息。

1. 有一个项名为 ASC Default（ASC 指的是 Azure 安全中心，现更名为 Microsoft Defender for Cloud），其范围是“Azure Pass - 赞助”。   选择“**ASC Default**”。

1. 在页面顶部的“概要”下，可以看到名称、描述和其他基本信息。  阅读描述（将鼠标悬停在描述上）。备注：说明字段引用 Azure 安全中心（已更名为 Microsoft Defender for Cloud）。

1. 请注意，仪表板提供的信息已更新，可反映所选项目，即 ASC Default 计划定义。  回想一下，计划定义是策略定义的集合，专为实现一个单一的总体目标而量身定制。可以按组、策略、非合规资源或事件查看信息。

1. 选择窗口右上角的“**X**”，退出 ASC 页面并返回到策略主页。

1. 从左侧导航面板中，选择 **“入门指南”**。 你可以在此处查看不同的选项，包括浏览内置策略和大规模分配策略的选项，可以为环境创建自定义策略定义，推荐策略分配等等。

1. 从左侧导航面板中，选择 **“合规性”**。 与“概述”页面一样，你可以在此处查看所列策略和/或计划的合规状态。  从“策略合规性”页面，还可以分配策略或计划（将在下一个任务中分配策略）。

1. 从左侧导航面板中，选择 **“修正”**。 此页面提供了一系列具有不合规资源的策略。  通过选择“修正”页上的策略，可以触发创建修正策略任务。  

1. 在左侧导航面板的“创作”下，选择 **“分配”**。 在此处可以看到当前的策略和/或计划分配，并且可以创建策略分配或计划。  你将在下一任务中返回到此处。  

1. 从左侧导航面板中，选择 **“定义”**。 在此页面中，选择 **“审核使用不安全密码安全设置的计算机”**。 这是一个包含许多策略的计划定义。  若要查看策略定义，请选择 **“审核未将最长密码期限设为 70 天的 Windows 计算机”**。 页面打开时，将显示 Java Script 对象表示法 (JSON) 结构中的实际策略定义。 从红色文本中可以看出，策略定义包含定义显示名称、描述、参数和策略规则等的元素。请勿更改任何内容。  

1. 选择页面右上角的 **“X”**，退出“策略定义”页面。

1. 选择页面右上角的 **“X”**， 退出“计划定义”页面。

1. 将此浏览器选项卡（策略 – Microsoft Azure）保持打开状态以进行下一个任务。

#### 任务 2：  在此任务中，你将创建一个基本策略分配以要求资源组上带有标记。

1. 打开浏览器选项卡“策略 - Microsoft Azure”。

1. 在左侧导航面板的“创作”下，选择 **“分配”**。

1. 在页面顶部选择 **“分配策略”**。

1. 这会打开分配策略向导，在分配策略的过程中向管理员提供指导。 选择 **“策略定义”** 字段旁的省略号。 此时会显示可用策略定义列表。  

1. 在搜索栏中，输入 **“标记”**。

1. 在搜索结果中，选择 **“要求资源组上带有标记”** （可能需要向下滚动才能看到），然后按 **“选择”**。 备注：此策略的效果是拒绝创建任何不满足要求的新资源组。  

1. 记下默认分配名称。  保持名称不变，在页面底部选择 **“下一步”**。

1. 在“标记名称”字段中，输入 **“环境”**， 然后选择 **“下一步”**。  

1. 在“不合规”消息中，输入 **“需要环境标记”**，然后选择 **“下一步”**。备注：对于在策略分配之前创建且没有环境标记的资源组，将显示此消息作为不合规的原因。  对于在策略创建后再创建的资源组，如果没有环境标记，将拒绝创建资源组。

1. 查看策略分配，然后选择“创建”。  如果未立即看到该策略，请选择 **“刷新”**。 备注：策略最多可能 30 分钟后就会生效。

1. 选择屏幕右上角的 **“X”**，退出“策略分配”页面。

1. 现在位于 Azure 服务主页。  请将此页面保持在打开状态，在下一个任务中将用到它。

#### 任务 3：  在此任务中，通过在 Azure 中创建一个没有标记的资源组，你将看到 Azure 策略分配的影响，然后你将更新资源组以包含标记。  备注：上一个任务中创建的策略可能需要长达 30 分钟才能生效，但通常会更快。

1. 打开浏览器选项卡“主页 - Microsoft Azure”。

1. 在页面顶部显示 Azure 服务的位置下方，选择 **“资源组”**。

1. 在页面左上角选择 **“+ 创建”**。

1. 在“创建资源组”的“基本信息”选项卡中，保持“订阅”字段（Azure Pass - 赞助）不变。

1. 在“资源组”字段中输入 **“SC900-Labs”**。

1. 将“区域”设置保留默认值，然后选择 **“下一步: 标记”**。

1. 将标记的“名称”和“值”字段保留为空白。  请勿填充，然后选择 **“查看 + 创建”**。

1. 你将看到验证通过（标记名称和值不是向导中的必填字段），然后选择 **“创建”**。

1. 屏幕顶部将显示一条失败消息，指示“资源组创建失败。查看错误详细信息”。 选择 **“查看错误详细信息”**。不满足该 Azure 策略包含的条件，因此资源组创建因不合规而遭到阻止。备注：如果没有看到失败消息，且资源组已创建，则原因是该策略尚未生效。  请转到“策略”页面，查看在上一任务中创建的策略；策略生效后，将看到该资源不合规。  详细信息页面将包含“不合规”消息。

1. 错误摘要显示错误类型“策略禁止使用资源 SC900-Labs”。  选择屏幕左上角的 **“X”** 关闭此窗口。

1. 在“创建资源组”窗口中，选择 **“<上一步”**。

1. 这会回到创建资源组的“标记”页面。  在“名称”字段输入“环境”，在“值”字段输入 **“SC900-Labs”**，然后选择 **“下一步: 查看 + 创建 >”**。

1. 验证标记，然后选择 **“创建”**。

1. 你将看到资源组被列出。  由于此标记是在该资源组中提供的，因此满足该 Azure 策略中包含的条件。  该资源组符合此策略。

1. 退出之前请删除 Azure 策略。
    1. 从页面的左上角，选择“主页”，返回到 Azure 主页。
    
    1. 在显示 Azure 服务的下方，选择“Azure 策略”。
    1. 在页面中间，你将看到 Azure 策略/计划分配的列表。  选择策略分配“要求资源组上带有标记”的省略号，然后选择“删除分配”。
    1. 系统会提示确认删除该分配。  选择“是”。


#### 回顾

在本实验室中，你浏览了 Azure 策略的登陆页面。在初步探索“Azure 策略”页面后，你完成了创建策略的过程，并能够了解该策略的影响。
